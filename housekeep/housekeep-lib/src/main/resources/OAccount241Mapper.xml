<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="house.keep.mybatis.dao.housekeeper.OAccount241Mapper">
  <resultMap id="BaseResultMap" type="house.keep.mybatis.model.housekeeper.OAccount241">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 01 16:53:22 JST 2019.
    -->
    <result column="PAYMENT_DATE" jdbcType="TIMESTAMP" property="paymentDate" />
    <result column="EXPENSE" jdbcType="VARCHAR" property="expense" />
    <result column="IN_AMOUNT" jdbcType="DECIMAL" property="inAmount" />
    <result column="OUT_AMOUNT" jdbcType="DECIMAL" property="outAmount" />
  </resultMap>
  <resultMap id="ActualValueResult" type="house.keep.mybatis.model.housekeeper.ActualValueResultEntity">
    <result column="TARGET_MONTHLY_BALANCE" jdbcType="DECIMAL" property="targetMonthlyBalance" />
    <result column="INCOME" jdbcType="DECIMAL" property="income" />
    <result column="REMITTANCE" jdbcType="DECIMAL" property="remittance" />
    <result column="MONTHLY_USAGE" jdbcType="DECIMAL" property="monthlyUsage" />
    <result column="MONTHLY_BALANCE" jdbcType="DECIMAL" property="monthlyBalance" />
  </resultMap>
	<resultMap id="OtherResultMap"
		type="house.keep.mybatis.model.housekeeper.OOther">
		<!-- WARNING - @mbg.generated This element is automatically generated by
			MyBatis Generator, do not modify. This element was generated on Sun May 12
			15:00:08 JST 2019. -->
		<result column="PAYMENT_DATE" jdbcType="TIMESTAMP"
			property="paymentDate" />
		<result column="AMOUNT" jdbcType="DECIMAL" property="amount" />
		<result column="EXPENSE" jdbcType="VARCHAR" property="expense" />
		<result column="DETAIL" jdbcType="VARCHAR" property="detail" />
	</resultMap>
  <insert id="insert" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 01 16:53:22 JST 2019.
    -->
    insert into HOUSEKEEPER.O_ACCOUNT241 (PAYMENT_DATE, EXPENSE, IN_AMOUNT,
      OUT_AMOUNT)
    values (#{paymentDate,jdbcType=TIMESTAMP}, #{expense,jdbcType=VARCHAR}, #{inAmount,jdbcType=DECIMAL},
      #{outAmount,jdbcType=DECIMAL})
  </insert>

	<select id="selectAsMonth" resultMap="BaseResultMap">
		<![CDATA[
			SELECT
			        x.PAYMENT_DATE AS PAYMENT_DATE
			        ,x.IN_AMOUNT AS IN_AMOUNT
			        ,x.OUT_AMOUNT AS OUT_AMOUNT
			        ,x.SUM AS SUM
			        ,x.EXPENSE AS EXPENSE
			    FROM
			        O_ACCOUNT241 x
			    ORDER BY
			        PAYMENT_DATE ASC
		]]>
	</select>

	<select id="selectWherePaymentdateByStringDateYYMM" resultMap="BaseResultMap" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
		<![CDATA[
			SELECT
	            a.PAYMENT_DATE AS PAYMENT_DATE
	            ,a.IN_AMOUNT AS IN_AMOUNT
	            ,a.OUT_AMOUNT AS OUT_AMOUNT
	            ,a. SUM AS SUM
	            ,a.EXPENSE AS EXPENSE
	        FROM
	            O_ACCOUNT241 a
	        WHERE
	            TO_CHAR(a.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{paymentDate,jdbcType=TIMESTAMP}, 'YYMM')
	            AND	a.EXPENSE LIKE '%給与%'
		]]>
	</select>

	<select id="selectNextPaymentdate" resultMap="BaseResultMap" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
		<![CDATA[
			SELECT
	            a.PAYMENT_DATE AS PAYMENT_DATE
	            ,a.IN_AMOUNT AS IN_AMOUNT
	            ,a.OUT_AMOUNT AS OUT_AMOUNT
	            ,a. SUM AS SUM
	            ,a.EXPENSE AS EXPENSE
	        FROM
	            O_ACCOUNT241 a
	        WHERE
	            TO_CHAR(#{paymentDate,jdbcType=TIMESTAMP}, 'YYYYMMDD') < TO_CHAR(a.PAYMENT_DATE, 'YYYYMMDD')
	            AND	a.EXPENSE LIKE '%給与%'
	            AND rownum = 1
	        ORDER BY
        		a.PAYMENT_DATE ASC
		]]>
	</select>

	<select id="selectGroupByExpenseWhereFromTo" resultMap="BaseResultMap" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
		<![CDATA[
			SELECT
			        SUM(a.IN_AMOUNT) AS IN_AMOUNT
			        ,SUM(a.OUT_AMOUNT) AS OUT_AMOUNT
			        ,a.EXPENSE AS EXPENSE
			    FROM
			        O_ACCOUNT241 a
			    WHERE
			        a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			    GROUP BY
			        a.EXPENSE
		]]>
	</select>

	<select id="selectGroupByExpenseWhereFromToAndDetails" resultMap="OtherResultMap" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
		<![CDATA[
			SELECT
			        SUM(AMOUNT) AS AMOUNT
			        ,EXPENSE AS EXPENSE
			        ,DETAIL AS DETAIL
			    FROM
			        (
			            -- O_OTHER
			            SELECT
			                    SUM(a.AMOUNT) AS AMOUNT
			                    ,a.EXPENSE AS EXPENSE
			                    ,'' AS DETAIL
			                FROM
			                    O_OTHER a
			                WHERE
			                    a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			                GROUP BY
			                    a.EXPENSE
			            UNION ALL
			            -- O_FOOD
			            SELECT
			                    SUM(a.AMOUNT) AS AMOUNT
			                    ,'食費' AS EXPENSE
			                    ,'食費' AS DETAIL
			                FROM
			                    O_FOOD a
			                WHERE
			                    a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			            UNION ALL
			            -- O_LIVE
			            SELECT
			                    SUM(a.AMOUNT) AS AMOUNT
			                    ,'生活用品費' AS EXPENSE
			                    ,'生活用品費' AS DETAIL
			                FROM
			                    O_LIVE a
			                WHERE
			                    a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			            UNION ALL
			            -- O_WASTE
			            SELECT
			                    SUM(a.AMOUNT) AS AMOUNT
			                    ,'娯楽費' AS EXPENSE
			                    ,a.EXPENSE AS DETAIL
			                FROM
			                    O_WASTE a
			                WHERE
			                    a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			                GROUP BY
			                    a.EXPENSE
			            UNION ALL
			            -- O_ENTERTAINMENT
			            SELECT
			                    SUM(a.AMOUNT) AS AMOUNT
			                    ,'交際費' AS EXPENSE
			                    ,'交際費' AS DETAIL
			                FROM
			                    O_ENTERTAINMENT a
			                WHERE
			                    a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			            UNION ALL
			            -- O_GOODS
			            SELECT
			                    SUM(a.AMOUNT) AS AMOUNT
			                    ,'物品購入費' AS EXPENSE
			                    ,a.EXPENSE AS DETAIL
			                FROM
			                    O_GOODS a
			                WHERE
			                    a.PAYMENT_DATE BETWEEN #{singleSheetFrom,jdbcType=TIMESTAMP} AND #{singleSheetTo,jdbcType=TIMESTAMP}
			                GROUP BY
			                    a.EXPENSE
			        )
			    GROUP BY
			        EXPENSE
			        ,DETAIL
			ORDER BY
				EXPENSE, DETAIL
		]]>
	</select>



	<select id="selectActuaResults" resultMap="ActualValueResult" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
		<![CDATA[
			SELECT
			        TARGET_MONTHLY_BALANCE AS TARGET_MONTHLY_BALANCE -- 月初残高
			        ,TARGET_PATMENT_DATE_IN_AMOUNT + INCOME AS INCOME -- 入金
			        ,REMITTANCE AS REMITTANCE -- 送金
			        ,TARGET_PATMENT_DATE_IN_AMOUNT AS BUDGET -- 当月予算
			        ,(TARGET_PATMENT_DATE_SUM + INCOME - REMITTANCE) - MONTHLY_BALANCE AS MONTHLY_USAGE -- 当月使用額
			        ,MONTHLY_BALANCE AS MONTHLY_BALANCE -- 翌月繰越し
			    FROM
			        (
			            SELECT
			                    SUM(X.IN_AMOUNT) AS INCOME
			                FROM
			                    HOUSEKEEPER.O_ACCOUNT241 X
			                    ,(
			                        SELECT
			                                A.PAYMENT_DATE AS TARGET_PAYMENT_DATE
			                            FROM
			                                HOUSEKEEPER.O_ACCOUNT241 A
			                            WHERE
			                                A.EXPENSE = 'MF（給与）'
			                                AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
			                    )
			                    ,(
									SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
									                        A.EXPENSE = 'MF（給与）'
									                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
									             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
									                        A.EXPENSE = 'MF（給与）'
									                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
									             ELSE SYSDATE END AS PAYMENT_DATE_TO
									    FROM
									        DUAL
			                    )
			                WHERE
			                    X.PAYMENT_DATE BETWEEN TARGET_PAYMENT_DATE AND PAYMENT_DATE_TO
			                    AND X.EXPENSE != 'MF（給与）'
			        )
			        ,(
			            SELECT
			                    NVL(SUM(X.OUT_AMOUNT), 0) AS REMITTANCE
			                FROM
			                    HOUSEKEEPER.O_ACCOUNT241 X
			                    ,(
			                        SELECT
			                                A.PAYMENT_DATE AS TARGET_PAYMENT_DATE
			                            FROM
			                                HOUSEKEEPER.O_ACCOUNT241 A
			                            WHERE
			                                A.EXPENSE = 'MF（給与）'
			                                AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
			                    )
			                    ,(
									SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
									                        A.EXPENSE = 'MF（給与）'
									                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
									             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
									                        A.EXPENSE = 'MF（給与）'
									                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
									             ELSE SYSDATE END AS PAYMENT_DATE_TO
									    FROM
									        DUAL
			                    )
			                WHERE
			                    X.PAYMENT_DATE BETWEEN TARGET_PAYMENT_DATE AND PAYMENT_DATE_TO
			                    AND X.EXPENSE = '送金（461）'
			        )
			        ,(
			            SELECT
			                    A. SUM - A.IN_AMOUNT AS TARGET_MONTHLY_BALANCE
			                FROM
			                    HOUSEKEEPER.O_ACCOUNT241 A
			                WHERE
			                    A.EXPENSE = 'MF（給与）'
			                    AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
			        )
			        ,(
			            SELECT
			                    A.PAYMENT_DATE AS TARGET_PAYMENT_DATE
			                    ,A.IN_AMOUNT AS TARGET_PATMENT_DATE_IN_AMOUNT
			                    ,A. SUM AS TARGET_PATMENT_DATE_SUM
			                FROM
			                    HOUSEKEEPER.O_ACCOUNT241 A
			                WHERE
			                    A.EXPENSE = 'MF（給与）'
			                    AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
			        )
			        ,(
						SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
						                        A.EXPENSE = 'MF（給与）'
						                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
						             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
						                        A.EXPENSE = 'MF（給与）'
						                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
						             ELSE SYSDATE END AS PAYMENT_DATE_TO,
							     CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
							                A.EXPENSE = 'MF（給与）'
							                AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
							     THEN (SELECT A. SUM - A.IN_AMOUNT AS MONTHLY_BALANCE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
							                A.EXPENSE = 'MF（給与）'
							                AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
							     ELSE (SELECT B.SUM - B.IN_AMOUNT AS MONTHLY_BALANCE
											  FROM (SELECT A.SUM, A.IN_AMOUNT FROM HOUSEKEEPER.O_ACCOUNT241 A ORDER BY A.PAYMENT_DATE DESC) B
											 WHERE ROWNUM = 1 )
							     END AS MONTHLY_BALANCE
						    FROM
						        DUAL
			        )
		]]>
	</select>

	<select id="selectActuaResults461" resultMap="ActualValueResult" parameterType="house.keep.mybatis.model.housekeeper.OAccount241">
		<![CDATA[
			SELECT
			        TARGET_MONTHLY_BALANCE AS TARGET_MONTHLY_BALANCE -- 月初残高
			        ,IN_AMOUNT_SUM AS INCOME -- 入金
			        ,OUT_AMOUNT_SUM - TEMP_IN_AMOUNT_SUM AS MONTHLY_USAGE -- 当月使用額
			        ,MONTHLY_BALANCE AS MONTHLY_BALANCE -- 翌月繰越し
			    FROM
			        (
			            SELECT
			                    O_ACCOUNT461_ASC. SUM - O_ACCOUNT461_ASC.IN_AMOUNT + O_ACCOUNT461_ASC.OUT_AMOUNT AS TARGET_MONTHLY_BALANCE -- 月初残高
			                FROM
			                    (
			                        SELECT
			                                PAYMENT_DATE
			                                ,EXPENSE
			                                ,IN_AMOUNT
			                                ,OUT_AMOUNT
			                                ,SUM
			                            FROM
			                                HOUSEKEEPER.O_ACCOUNT461
			                                ,(
			                                    SELECT
			                                            A.PAYMENT_DATE AS TARGET_PAYMENT_DATE
			                                        FROM
			                                            HOUSEKEEPER.O_ACCOUNT241 A
			                                        WHERE
			                                            A.EXPENSE = 'MF（給与）'
			                                            AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
			                                )
			                                ,(
												SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
												                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
												             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
												                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
												             ELSE SYSDATE END AS PAYMENT_DATE_TO
												    FROM
												        DUAL
			                                )
			                            WHERE
			                                PAYMENT_DATE BETWEEN TARGET_PAYMENT_DATE AND PAYMENT_DATE_TO
			                            ORDER BY
			                                PAYMENT_DATE ASC
			                    ) O_ACCOUNT461_ASC
			                WHERE
			                    ROWNUM = 1
			        )
			        ,(
			            SELECT
			                    O_ACCOUNT461_DESC. SUM AS MONTHLY_BALANCE -- 翌月繰越し
			                FROM
			                    (
			                        SELECT
			                                PAYMENT_DATE
			                                ,EXPENSE
			                                ,IN_AMOUNT
			                                ,OUT_AMOUNT
			                                ,SUM
			                            FROM
			                                HOUSEKEEPER.O_ACCOUNT461
			                                ,(
			                                    SELECT
			                                            A.PAYMENT_DATE AS TARGET_PAYMENT_DATE
			                                        FROM
			                                            HOUSEKEEPER.O_ACCOUNT241 A
			                                        WHERE
			                                            A.EXPENSE = 'MF（給与）'
			                                            AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
			                                )
			                                ,(
												SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
												                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
												             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
												                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
												             ELSE SYSDATE END AS PAYMENT_DATE_TO
												    FROM
												        DUAL
			                                )
			                            WHERE
			                                PAYMENT_DATE BETWEEN TARGET_PAYMENT_DATE AND PAYMENT_DATE_TO
			                            ORDER BY
			                                PAYMENT_DATE DESC
			                    ) O_ACCOUNT461_DESC
			                WHERE
			                    ROWNUM = 1
			        )
			        ,(
			        SELECT
			        		NVL(SUM(OUT_AMOUNT),0) AS OUT_AMOUNT_SUM -- 当月出金合計
						FROM
							(
					            SELECT
		                                PAYMENT_DATE
		                                ,EXPENSE
		                                ,IN_AMOUNT
		                                ,OUT_AMOUNT
		                                ,SUM
		                                ,PAYMENT_DATE_FROM
		                                ,PAYMENT_DATE_TO
					                FROM
		                                HOUSEKEEPER.O_ACCOUNT461
		                                ,(
		                                	-- PAYMENT_DATE_FROM
		                                    SELECT
		                                            A.PAYMENT_DATE AS PAYMENT_DATE_FROM
		                                        FROM
		                                            HOUSEKEEPER.O_ACCOUNT241 A
		                                        WHERE
		                                            A.EXPENSE = 'MF（給与）'
		                                            AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
		                                )
		                                ,(
		                                	-- PAYMENT_DATE_TO
											SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
											                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
											             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
											                        A.EXPENSE = 'MF（給与）'
											                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
											             ELSE SYSDATE END AS PAYMENT_DATE_TO
											    FROM
											        DUAL
				                                )
							)
						WHERE
						    PAYMENT_DATE BETWEEN PAYMENT_DATE_FROM AND PAYMENT_DATE_TO
			        )
			        ,(
			        SELECT
			        		NVL(SUM(IN_AMOUNT),0) AS IN_AMOUNT_SUM -- 当月送金合計
						FROM
							(
					            SELECT
		                                PAYMENT_DATE
		                                ,EXPENSE
		                                ,IN_AMOUNT
		                                ,OUT_AMOUNT
		                                ,SUM
		                                ,PAYMENT_DATE_FROM
		                                ,PAYMENT_DATE_TO
					                FROM
		                                HOUSEKEEPER.O_ACCOUNT461
		                                ,(
		                                	-- PAYMENT_DATE_FROM
		                                    SELECT
		                                            A.PAYMENT_DATE AS PAYMENT_DATE_FROM
		                                        FROM
		                                            HOUSEKEEPER.O_ACCOUNT241 A
		                                        WHERE
		                                            A.EXPENSE = 'MF（給与）'
		                                            AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
		                                )
		                                ,(
		                                	-- PAYMENT_DATE_TO
											SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
											                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
											             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
											                        A.EXPENSE = 'MF（給与）'
											                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
											             ELSE SYSDATE END AS PAYMENT_DATE_TO
											    FROM
											        DUAL
				                                )
							)
						WHERE
						    PAYMENT_DATE BETWEEN PAYMENT_DATE_FROM AND PAYMENT_DATE_TO
						    AND EXPENSE = '入金（口座241）'
			        )
			        ,(
			        SELECT
			        		NVL(SUM(IN_AMOUNT),0) AS TEMP_IN_AMOUNT_SUM -- 当月入金合計
						FROM
							(
					            SELECT
		                                PAYMENT_DATE
		                                ,EXPENSE
		                                ,IN_AMOUNT
		                                ,OUT_AMOUNT
		                                ,SUM
		                                ,PAYMENT_DATE_FROM
		                                ,PAYMENT_DATE_TO
					                FROM
		                                HOUSEKEEPER.O_ACCOUNT461
		                                ,(
		                                	-- PAYMENT_DATE_FROM
		                                    SELECT
		                                            A.PAYMENT_DATE AS PAYMENT_DATE_FROM
		                                        FROM
		                                            HOUSEKEEPER.O_ACCOUNT241 A
		                                        WHERE
		                                            A.EXPENSE = 'MF（給与）'
		                                            AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(#{singleSheetFrom,jdbcType=TIMESTAMP}, 'YYMM')
		                                )
		                                ,(
		                                	-- PAYMENT_DATE_TO
											SELECT CASE WHEN EXISTS (SELECT 1 FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
												                        A.EXPENSE = 'MF（給与）'
											                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
											             THEN (SELECT A.PAYMENT_DATE FROM HOUSEKEEPER.O_ACCOUNT241 A WHERE
											                        A.EXPENSE = 'MF（給与）'
											                        AND TO_CHAR(A.PAYMENT_DATE, 'YYMM') = TO_CHAR(SYSDATE, 'YYMM') )
											             ELSE SYSDATE END AS PAYMENT_DATE_TO
											    FROM
											        DUAL
				                                )
							)
						WHERE
						    PAYMENT_DATE BETWEEN PAYMENT_DATE_FROM AND PAYMENT_DATE_TO
						    AND EXPENSE = '入金'
			        )
		]]>
	</select>
</mapper>